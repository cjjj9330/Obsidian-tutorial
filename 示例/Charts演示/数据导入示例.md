# 数据导入示例

本文档展示了如何在 Obsidian Charts View 插件中从外部数据源导入数据，包括 CSV 文件和 Dataview 查询。

## Charts View Plugin 简介

Obsidian Charts View Plugin 是一个基于 Ant Design Charts 的数据可视化插件，支持多种图表类型和数据源。

### 基本语法结构

Charts View Plugin 使用以下基本结构：

```
#-----------------#
#- chart type    -#
#-----------------#
type: [图表类型]

#-----------------#
#- chart data    -#
#-----------------#
data: [数据源]

#-----------------#
#- chart options -#
#-----------------#
options:
  [图表配置选项]
```

## 从 CSV 文件导入数据

Charts View Plugin 支持从 CSV 文件导入数据，这对于处理大量数据特别有用。

### 创建 CSV 文件

首先，我们需要创建一个 CSV 文件。以下是一个示例 CSV 文件的内容，保存为 `月度销售数据.csv`：

```
月份,销售额,成本,利润
一月,12000,7000,5000
二月,19000,11000,8000
三月,15000,9000,6000
四月,25000,14000,11000
五月,22000,12500,9500
六月,30000,16000,14000
```

### 使用 CSV 数据创建图表

**从外部 CSV 文件导入（需要将 CSV 文件放在数据路径中）：**

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Line

#-----------------#
#- chart data    -#
#-----------------#
data: 月度销售数据.csv

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "月份"
  yField: "销售额"
  title:
    text: "月度销售数据分析"
  yAxis:
    title:
      text: "金额 (元)"
```

**多数据系列图表（柱状图）：**

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Column

#-----------------#
#- chart data    -#
#-----------------#
data:
  - 月份: "一月"
    类型: "销售额"
    数值: 12000
  - 月份: "一月"
    类型: "成本"
    数值: 7000
  - 月份: "一月"
    类型: "利润"
    数值: 5000
  - 月份: "二月"
    类型: "销售额"
    数值: 19000
  - 月份: "二月"
    类型: "成本"
    数值: 11000
  - 月份: "二月"
    类型: "利润"
    数值: 8000
  - 月份: "三月"
    类型: "销售额"
    数值: 15000
  - 月份: "三月"
    类型: "成本"
    数值: 9000
  - 月份: "三月"
    类型: "利润"
    数值: 6000

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "月份"
  yField: "数值"
  seriesField: "类型"
  title:
    text: "月度财务数据对比"
  yAxis:
    title:
      text: "金额 (元)"
```

### CSV 导入配置说明

- 使用 `data: filename.csv` 直接引用 CSV 文件
- CSV 文件需要放在插件设置中指定的数据路径中
- 第一行作为列标题
- 使用 `xField` 和 `yField` 指定 X 轴和 Y 轴数据列

## 从 Dataview 查询导入数据

Charts View Plugin 支持与 Dataview 插件集成，可以直接使用 Dataview 查询结果创建图表。

### 使用 Dataview 查询创建图表

**从笔记元数据生成图表：**

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Bar

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const pages = dv.pages('"示例/Charts演示/日常记录"')
    .where(p => p.date && p.study_hours)
    .sort(p => p.date)
    .limit(10);
  
  return pages.map(p => ({
    日期: p.date.toString(),
    学习时间: p.study_hours || 0,
    运动时间: p.exercise_hours || 0,
    阅读时间: p.reading_hours || 0
  }));
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "日期"
  yField: "学习时间"
  title:
    text: "每日学习时间统计"
  yAxis:
    title:
      text: "小时"
```

**堆积柱状图（多数据系列）：**

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Column

#-----------------#
#- chart data    -#
#-----------------#
data:
  - 日期: "2025-06-01"
    活动类型: "学习时间"
    小时数: 4
  - 日期: "2025-06-01"
    活动类型: "运动时间"
    小时数: 1
  - 日期: "2025-06-01"
    活动类型: "阅读时间"
    小时数: 2
  - 日期: "2025-06-02"
    活动类型: "学习时间"
    小时数: 3.5
  - 日期: "2025-06-02"
    活动类型: "运动时间"
    小时数: 1.5
  - 日期: "2025-06-02"
    活动类型: "阅读时间"
    小时数: 2.5

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "日期"
  yField: "小时数"
  seriesField: "活动类型"
  isStack: true
  title:
    text: "每日时间分配"
  yAxis:
    title:
      text: "小时"
```

## 高级图表示例

### 饼图

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Pie

#-----------------#
#- chart data    -#
#-----------------#
data:
  - 类型: "工作"
    小时数: 8
  - 类型: "学习"
    小时数: 4
  - 类型: "运动"
    小时数: 1
  - 类型: "娱乐"
    小时数: 3
  - 类型: "睡眠"
    小时数: 8

#-----------------#
#- chart options -#
#-----------------#
options:
  angleField: "小时数"
  colorField: "类型"
  title:
    text: "每日时间分配"
  radius: 0.8
  label:
    type: 'outer'
    content: '{name} {percentage}'
```

### 雷达图

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Radar

#-----------------#
#- chart data    -#
#-----------------#
data:
  - 项目: "产品质量"
    我们公司: 8
    竞争对手: 6
  - 项目: "客户服务"
    我们公司: 7
    竞争对手: 8
  - 项目: "价格竞争力"
    我们公司: 6
    竞争对手: 8
  - 项目: "市场营销"
    我们公司: 5
    竞争对手: 7
  - 项目: "技术创新"
    我们公司: 9
    竞争对手: 6
  - 项目: "品牌影响力"
    我们公司: 7
    竞争对手: 8

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "项目"
  yField: "我们公司"
  title:
    text: "市场竞争力分析"
  area:
    visible: true
  point:
    visible: true
```

### 双轴图

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: DualAxes

#-----------------#
#- chart data    -#
#-----------------#
data:
  - 月份: "一月"
    销售额: 12
    增长率: 0
  - 月份: "二月"
    销售额: 19
    增长率: 58.3
  - 月份: "三月"
    销售额: 15
    增长率: -21.1
  - 月份: "四月"
    销售额: 25
    增长率: 66.7
  - 月份: "五月"
    销售额: 22
    增长率: -12.0
  - 月份: "六月"
    销售额: 30
    增长率: 36.4

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "月份"
  yField: ["销售额", "增长率"]
  title:
    text: "销售数据与增长率分析"
  geometryOptions:
    - geometry: 'column'
      color: '#5B8FF9'
    - geometry: 'line'
      color: '#5AD8A6'
```

### 词云图

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: WordCloud

#-----------------#
#- chart data    -#
#-----------------#
data:
  - text: "Obsidian"
    value: 100
  - text: "笔记管理"
    value: 80
  - text: "知识图谱"
    value: 70
  - text: "Markdown"
    value: 60
  - text: "双向链接"
    value: 50
  - text: "插件生态"
    value: 45
  - text: "数据可视化"
    value: 40
  - text: "个人知识管理"
    value: 35
  - text: "思维导图"
    value: 30

#-----------------#
#- chart options -#
#-----------------#
options:
  wordField: "text"
  weightField: "value"
  title:
    text: "Obsidian 相关词汇热度"
  wordStyle:
    rotation: 30
```

## 与 Dataview 集成的高级用法

### 统计文件数量

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Pie

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const folders = {
    "设置文档": dv.pages('"Obsidian设置"').length,
    "示例文档": dv.pages('"示例"').length,
    "模板文件": dv.pages('"Templates"').length,
    "附件文件": dv.pages('"Attachment"').length
  };
  
  return Object.entries(folders).map(([name, count]) => ({
    文件夹: name,
    文件数量: count
  }));
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  angleField: "文件数量"
  colorField: "文件夹"
  title:
    text: "项目文件分布"
  radius: 0.8
```

### 任务完成情况统计

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Column

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const taskPages = dv.pages().where(p => p.file.tasks);
  const stats = [];
  
  for (let page of taskPages) {
    const tasks = page.file.tasks;
    const completed = tasks.filter(t => t.completed).length;
    const total = tasks.length;
    
    if (total > 0) {
      stats.push({
        页面: page.file.name,
        已完成: completed,
        未完成: total - completed,
        完成率: Math.round((completed / total) * 100)
      });
    }
  }
  
  return stats.slice(0, 10); // 只显示前10个
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "页面"
  yField: "已完成"
  title:
    text: "任务完成情况统计"
  yAxis:
    title:
      text: "任务数量"
```

## 搜索交互功能

Charts View Plugin 支持点击图表元素时触发 Obsidian 搜索功能：

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Bar

#-----------------#
#- chart data    -#
#-----------------#
data:
  - 标签: "工作"
    数量: 25
  - 标签: "学习"
    数量: 18
  - 标签: "项目"
    数量: 12

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "标签"
  yField: "数量"
  title:
    text: "标签使用统计（点击可搜索）"
  enableSearchInteraction:
    field: "标签"
    operator: "tag"
```

## 使用说明和注意事项

### 基本要求

1. **插件安装**：确保安装了 Charts View Plugin (obsidian-chartsview-plugin)
2. **代码块语言**：使用 `chartsview` 作为代码块语言
3. **数据格式**：支持 YAML 格式的数据或引用外部 CSV 文件
4. **Dataview 集成**：如果使用 Dataview 功能，需要安装 Dataview 插件

### 常见问题解决

1. **图表不显示**：
   - 检查插件是否正确安装并启用
   - 确认代码块语言为 `chartsview`
   - 检查数据格式是否正确

2. **CSV 文件读取失败**：
   - 确认 CSV 文件位于正确的数据路径
   - 检查文件编码（推荐使用 UTF-8）
   - 确认文件名和路径正确

3. **Dataview 查询错误**：
   - 确保 Dataview 插件已安装
   - 检查查询语法是否正确
   - 确认被查询的页面存在

### 支持的图表类型

- **基础图表**：Line, Bar, Column, Area, Pie
- **高级图表**：Radar, DualAxes, Mix, WordCloud
- **特殊图表**：Treemap, OrganizationTreeGraph, TinyLine

现在所有的图表都应该能够正常渲染了！Charts View Plugin 使用 Ant Design Charts 作为底层图表库，功能强大且易于使用。
