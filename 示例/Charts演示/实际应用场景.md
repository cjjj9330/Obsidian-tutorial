# 实际应用场景

本文档展示了Charts View Plugin在实际场景中的应用，包括与Dataview插件的集成使用，以及如何创建动态的、有意义的数据可视化图表。

## 个人知识管理统计

### 笔记创建时间分析

追踪你的笔记创建习惯，了解你的知识积累模式：

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Line

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const pages = dv.pages().where(p => p.file.ctime);
  const monthlyStats = {};
  
  for (let page of pages) {
    const month = page.file.ctime.toFormat('yyyy-MM');
    monthlyStats[month] = (monthlyStats[month] || 0) + 1;
  }
  
  return Object.entries(monthlyStats)
    .sort(([a], [b]) => a.localeCompare(b))
    .slice(-12) // 最近12个月
    .map(([month, count]) => ({
      月份: month,
      笔记数量: count
    }));
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "月份"
  yField: "笔记数量"
  title:
    text: "每月笔记创建数量趋势"
  point:
    size: 5
  yAxis:
    title:
      text: "笔记数量"
```

### 标签使用频率统计

分析你最常使用的标签，了解你的关注重点：

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Bar

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const allTags = dv.pages().flatMap(p => p.file.tags || []);
  const tagCounts = {};
  
  for (let tag of allTags) {
    const cleanTag = tag.replace('#', '');
    tagCounts[cleanTag] = (tagCounts[cleanTag] || 0) + 1;
  }
  
  return Object.entries(tagCounts)
    .sort(([,a], [,b]) => b - a)
    .slice(0, 10) // 前10个最常用标签
    .map(([tag, count]) => ({
      标签: tag,
      使用次数: count
    }));
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "使用次数"
  yField: "标签"
  title:
    text: "标签使用频率排行（前10名）"
  xAxis:
    title:
      text: "使用次数"
  enableSearchInteraction:
    field: "标签"
    operator: "tag"
```

## 项目管理可视化

### 任务完成率分析

使用Tasks插件的数据创建任务完成情况图表：

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Column

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const pages = dv.pages().where(p => p.file.tasks && p.file.tasks.length > 0);
  const projectStats = [];
  
  for (let page of pages) {
    const tasks = page.file.tasks;
    const completed = tasks.filter(t => t.completed).length;
    const total = tasks.length;
    const completionRate = Math.round((completed / total) * 100);
    
    if (total >= 3) { // 只统计有至少3个任务的页面
      projectStats.push({
        项目: page.file.name.length > 15 ? 
          page.file.name.substring(0, 12) + '...' : 
          page.file.name,
        已完成: completed,
        未完成: total - completed,
        完成率: completionRate
      });
    }
  }
  
  // 转换为堆积柱状图数据格式
  const result = [];
  for (let stat of projectStats.slice(0, 8)) { // 最多显示8个项目
    result.push({
      项目: stat.项目,
      状态: "已完成",
      数量: stat.已完成
    });
    result.push({
      项目: stat.项目,
      状态: "未完成", 
      数量: stat.未完成
    });
  }
  
  return result;
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "项目"
  yField: "数量"
  seriesField: "状态"
  isStack: true
  title:
    text: "项目任务完成情况"
  yAxis:
    title:
      text: "任务数量"
```

### 项目优先级分布

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Pie

#-----------------#
#- chart data    -#
#-----------------#
data:
  - 优先级: "高优先级"
    项目数: 5
  - 优先级: "中优先级"
    项目数: 12
  - 优先级: "低优先级"
    项目数: 8
  - 优先级: "待定"
    项目数: 3

#-----------------#
#- chart options -#
#-----------------#
options:
  angleField: "项目数"
  colorField: "优先级"
  title:
    text: "项目优先级分布"
  radius: 0.8
  label:
    type: 'outer'
    content: '{name}: {value}个 ({percentage})'
```

## 学习进度追踪

### 读书进度统计

追踪你的阅读习惯和进度：

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: DualAxes

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const bookPages = dv.pages('"Books"').where(p => p.status && p.pages_read);
  const monthlyReading = {};
  
  for (let book of bookPages) {
    if (book.last_read) {
      const month = book.last_read.toFormat('yyyy-MM');
      if (!monthlyReading[month]) {
        monthlyReading[month] = { pages: 0, books: 0 };
      }
      monthlyReading[month].pages += book.pages_read || 0;
      if (book.status === 'completed') {
        monthlyReading[month].books += 1;
      }
    }
  }
  
  return Object.entries(monthlyReading)
    .sort(([a], [b]) => a.localeCompare(b))
    .slice(-6) // 最近6个月
    .map(([month, data]) => ({
      月份: month,
      阅读页数: data.pages,
      完成书籍: data.books
    }));
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "月份"
  yField: ["阅读页数", "完成书籍"]
  title:
    text: "每月阅读统计"
  geometryOptions:
    - geometry: 'column'
      color: '#5B8FF9'
    - geometry: 'line'
      color: '#5AD8A6'
```

### 学习主题雷达图

评估你在不同学习领域的投入：

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Radar

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const subjects = ["编程", "设计", "写作", "商业", "科学", "历史"];
  const myProgress = [];
  
  for (let subject of subjects) {
    const pages = dv.pages().where(p => 
      p.file.tags && p.file.tags.some(tag => 
        tag.toLowerCase().includes(subject.toLowerCase())
      )
    );
    
    const score = Math.min(pages.length * 2, 10); // 限制最高分为10
    myProgress.push({
      主题: subject,
      投入度: score,
      目标: 8 // 设定的目标值
    });
  }
  
  // 转换为雷达图格式
  const result = [];
  for (let item of myProgress) {
    result.push({
      主题: item.主题,
      类型: "当前投入",
      数值: item.投入度
    });
    result.push({
      主题: item.主题,
      类型: "目标值",
      数值: item.目标
    });
  }
  
  return result;
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "主题"
  yField: "数值"
  seriesField: "类型"
  title:
    text: "学习领域投入度分析"
  area:
    visible: true
  point:
    visible: true
```

## 健康和习惯追踪

### 每日习惯打卡

使用元数据追踪每日习惯完成情况：

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Line

#-----------------#
#- chart data    -#
#-----------------#
data:
  - 日期: "2025-06-01"
    运动: 1
    阅读: 1
    冥想: 0
    早起: 1
  - 日期: "2025-06-02"
    运动: 0
    阅读: 1
    冥想: 1
    早起: 1
  - 日期: "2025-06-03"
    运动: 1
    阅读: 1
    冥想: 1
    早起: 0
  - 日期: "2025-06-04"
    运动: 1
    阅读: 0
    冥想: 1
    早起: 1
  - 日期: "2025-06-05"
    运动: 1
    阅读: 1
    冥想: 1
    早起: 1
  - 日期: "2025-06-06"
    运动: 0
    阅读: 1
    冥想: 0
    早起: 1
  - 日期: "2025-06-07"
    运动: 1
    阅读: 1
    冥想: 1
    早起: 1

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "日期"
  yField: "运动"
  title:
    text: "每日运动习惯追踪"
  point:
    size: 5
  yAxis:
    min: 0
    max: 1
    title:
      text: "完成情况"
```

### 习惯完成率热力图

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Column

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const habits = ["运动", "阅读", "冥想", "早起", "写作"];
  const dailyPages = dv.pages('"Daily"').where(p => p.date).sort(p => p.date, 'desc').limit(30);
  
  const habitStats = habits.map(habit => {
    let completed = 0;
    let total = 0;
    
    for (let page of dailyPages) {
      if (page[habit] !== undefined) {
        total++;
        if (page[habit]) completed++;
      }
    }
    
    return {
      习惯: habit,
      完成率: total > 0 ? Math.round((completed / total) * 100) : 0,
      完成天数: completed,
      总天数: total
    };
  });
  
  return habitStats;
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "习惯"
  yField: "完成率"
  title:
    text: "近30天习惯完成率统计"
  yAxis:
    max: 100
    title:
      text: "完成率 (%)"
  label:
    visible: true
    position: 'middle'
    content: '{value}%'
```

## 写作和创作统计

### 每月写作字数统计

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Area

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const writingPages = dv.pages().where(p => 
    p.file.name.includes('写作') || 
    p.file.tags?.includes('#写作') ||
    p.type === 'article'
  );
  
  const monthlyWords = {};
  
  for (let page of writingPages) {
    const month = page.file.ctime.toFormat('yyyy-MM');
    const wordCount = page.word_count || page.file.size || 500; // 估算字数
    
    monthlyWords[month] = (monthlyWords[month] || 0) + wordCount;
  }
  
  return Object.entries(monthlyWords)
    .sort(([a], [b]) => a.localeCompare(b))
    .slice(-8) // 最近8个月
    .map(([month, words]) => ({
      月份: month,
      字数: words,
      目标: 10000 // 每月目标字数
    }));
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "月份"
  yField: "字数"
  title:
    text: "每月写作字数统计"
  area:
    color: '#722ED1'
  line:
    color: '#722ED1'
  yAxis:
    title:
      text: "字数"
```

### 创作主题分布

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Treemap

#-----------------#
#- chart data    -#
#-----------------#
data:
  - 类别: "技术文章"
    数量: 25
  - 类别: "生活感悟"
    数量: 18
  - 类别: "读书笔记"
    数量: 32
  - 类别: "项目总结"
    数量: 15
  - 类别: "教程指南"
    数量: 22
  - 类别: "随笔杂记"
    数量: 28

#-----------------#
#- chart options -#
#-----------------#
options:
  colorField: "类别"
  valueField: "数量"
  title:
    text: "创作内容主题分布"
  label:
    visible: true
    content: '{name}\n{value}篇'
```

## 网络分析

### 笔记链接关系强度

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Bar

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const pages = dv.pages().limit(20); // 限制数量避免性能问题
  const linkStats = [];
  
  for (let page of pages) {
    const outLinks = page.file.outlinks?.length || 0;
    const inLinks = page.file.inlinks?.length || 0;
    const totalLinks = outLinks + inLinks;
    
    if (totalLinks > 0) {
      linkStats.push({
        页面: page.file.name.length > 15 ? 
          page.file.name.substring(0, 12) + '...' : 
          page.file.name,
        出链: outLinks,
        入链: inLinks,
        总链接: totalLinks
      });
    }
  }
  
  return linkStats
    .sort((a, b) => b.总链接 - a.总链接)
    .slice(0, 10)
    .map(stat => [
      { 页面: stat.页面, 方向: "出链", 数量: stat.出链 },
      { 页面: stat.页面, 方向: "入链", 数量: stat.入链 }
    ]).flat();
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "数量"
  yField: "页面"
  seriesField: "方向"
  title:
    text: "笔记链接关系强度（前10名）"
  xAxis:
    title:
      text: "链接数量"
```

## 时间分析

### 创作时间分布

分析你在一天中的哪个时段最有创造力：

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Column

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  const pages = dv.pages().where(p => p.file.ctime);
  const hourStats = Array(24).fill(0);
  
  for (let page of pages) {
    const hour = page.file.ctime.hour;
    hourStats[hour]++;
  }
  
  return hourStats.map((count, hour) => ({
    时间: `${hour}:00`,
    创建数量: count
  }));
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "时间"
  yField: "创建数量"
  title:
    text: "24小时创作时间分布"
  yAxis:
    title:
      text: "笔记创建数量"
```

## 错误处理和性能优化

### 带错误处理的图表

```chartsview
#-----------------#
#- chart type    -#
#-----------------#
type: Line

#-----------------#
#- chart data    -#
#-----------------#
data: |
  ```dataviewjs
  try {
    const pages = dv.pages().where(p => p.file.ctime);
    
    if (pages.length === 0) {
      return [{ 日期: "无数据", 数量: 0 }];
    }
    
    const recentPages = pages.sort(p => p.file.ctime, 'desc').limit(30);
    const dailyStats = {};
    
    for (let page of recentPages) {
      const date = page.file.ctime.toFormat('MM-dd');
      dailyStats[date] = (dailyStats[date] || 0) + 1;
    }
    
    return Object.entries(dailyStats)
      .sort(([a], [b]) => a.localeCompare(b))
      .map(([date, count]) => ({
        日期: date,
        创建数量: count
      }));
      
  } catch (error) {
    return [{ 日期: "错误", 数量: 0, 错误信息: error.message }];
  }
  ```

#-----------------#
#- chart options -#
#-----------------#
options:
  xField: "日期"
  yField: "创建数量"
  title:
    text: "最近30天笔记创建趋势"
  point:
    size: 3
```

## 使用建议

### 性能优化建议

1. **限制数据量**：使用 `.limit()` 限制查询结果数量
2. **缓存数据**：对于复杂查询，考虑将结果保存到单独的笔记中
3. **合理使用实时查询**：不是所有图表都需要实时更新

### 最佳实践

1. **数据验证**：始终检查数据的存在性和有效性
2. **错误处理**：使用 try-catch 语句处理可能的错误
3. **用户体验**：为图表添加有意义的标题和标签
4. **交互设计**：合理使用搜索交互功能

### 常见问题解决

1. **图表不显示**：
   - 检查 Charts View Plugin 是否正确安装
   - 确认使用 `chartsview` 代码块
   - 验证数据格式是否正确

2. **Dataview 查询错误**：
   - 确保 Dataview 插件已安装并启用
   - 检查查询语法
   - 验证数据源存在

3. **性能问题**：
   - 减少查询的数据量
   - 使用更具体的过滤条件
   - 考虑数据缓存策略

通过这些实际应用场景，你可以充分利用 Charts View Plugin 的强大功能，将你的 Obsidian 知识库转化为富有洞察力的数据仪表板！
